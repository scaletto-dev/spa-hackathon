generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// User model - Registered members and administrators
/// Guest users don't have User records - their info is stored in Booking/Review
model User {
  id             String     @id @default(uuid())
  email          String     @unique
  phone          String
  fullName       String
  role           UserRole   @default(MEMBER)
  emailVerified  Boolean    @default(false)
  supabaseAuthId String?    @unique
  language       String     @default("vi")
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  blogPosts      BlogPost[]
  bookings       Booking[]
  reviews        Review[]

  @@index([email])
  @@index([supabaseAuthId])
  @@index([role])
}

/// ServiceCategory model - Organizes services into groups
model ServiceCategory {
  id           String    @id @default(uuid())
  name         String
  slug         String    @unique
  description  String?
  displayOrder Int       @default(0)
  icon         String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  services     Service[]
}

/// Service model - Individual beauty treatments and procedures
model Service {
  id                String          @id @default(uuid())
  name              String
  slug              String          @unique
  description       String
  excerpt           String
  duration          Int
  price             Decimal         @db.Decimal(10, 2)
  categoryId        String
  images            String[]
  featured          Boolean         @default(false)
  active            Boolean         @default(true)
  beforeAfterPhotos String[]
  faqs              Json?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  bookings          Booking[]
  reviews           Review[]
  category          ServiceCategory @relation(fields: [categoryId], references: [id])

  @@index([slug])
  @@index([categoryId])
  @@index([featured])
}

/// Branch model - Physical clinic locations
model Branch {
  id             String    @id @default(uuid())
  name           String
  slug           String    @unique
  address        String
  phone          String
  email          String?
  latitude       Decimal   @db.Decimal(10, 8)
  longitude      Decimal   @db.Decimal(11, 8)
  operatingHours Json
  images         String[]
  active         Boolean   @default(true)
  description    String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  bookings       Booking[]

  @@index([slug])
}

/// Booking model - Appointment reservations (supports guest and member bookings)
model Booking {
  id                 String        @id @default(uuid())
  referenceNumber    String        @unique
  userId             String?
  serviceId          String
  branchId           String
  appointmentDate    DateTime
  appointmentTime    String
  status             BookingStatus @default(CONFIRMED)
  guestName          String?
  guestEmail         String?
  guestPhone         String?
  notes              String?
  language           String        @default("vi")
  cancellationReason String?
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
  branch             Branch        @relation(fields: [branchId], references: [id])
  service            Service       @relation(fields: [serviceId], references: [id])
  user               User?         @relation(fields: [userId], references: [id])

  @@index([referenceNumber])
  @@index([appointmentDate])
  @@index([userId])
  @@index([serviceId])
  @@index([branchId])
  @@index([status])
}

/// BlogCategory model - Organizes blog posts into topics
model BlogCategory {
  id          String     @id @default(uuid())
  name        String
  slug        String     @unique
  description String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  posts       BlogPost[]
}

/// BlogPost model - Blog articles for content marketing and SEO
model BlogPost {
  id            String       @id @default(uuid())
  title         String
  slug          String       @unique
  content       String
  excerpt       String
  featuredImage String
  categoryId    String
  authorId      String
  published     Boolean      @default(false)
  publishedAt   DateTime?
  language      String       @default("vi")
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  author        User         @relation(fields: [authorId], references: [id])
  category      BlogCategory @relation(fields: [categoryId], references: [id])

  @@index([slug])
  @@index([published])
  @@index([categoryId])
}

/// Review model - Customer reviews and ratings for services
model Review {
  id            String   @id @default(uuid())
  serviceId     String
  userId        String?
  customerName  String
  email         String
  rating        Int
  reviewText    String
  approved      Boolean  @default(false)
  adminResponse String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  avatar        String?
  service       Service  @relation(fields: [serviceId], references: [id])
  user          User?    @relation(fields: [userId], references: [id])
}

/// ContactSubmission model - Contact form submissions for admin review
model ContactSubmission {
  id          String        @id @default(uuid())
  name        String
  email       String
  phone       String?
  messageType MessageType
  message     String
  status      ContactStatus @default(PENDING)
  adminNotes  String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}

enum UserRole {
  MEMBER
  ADMIN
  SUPER_ADMIN
}

enum BookingStatus {
  CONFIRMED
  COMPLETED
  CANCELLED
  NO_SHOW
  PENDING
}

enum MessageType {
  GENERAL_INQUIRY
  SERVICE_QUESTION
  BOOKING_ASSISTANCE
  FEEDBACK
  OTHER
}

enum ContactStatus {
  PENDING
  IN_PROGRESS
  RESOLVED
}
